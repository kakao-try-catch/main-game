# í˜‘ë™ í”Œë˜í”¼ë²„ë“œ êµ¬í˜„ ê³„íš

## ğŸ“‹ ê°œìš”

Phaser 3ì™€ TypeScriptë¥¼ ì‚¬ìš©í•˜ì—¬ **í˜‘ë™ ë©€í‹°í”Œë ˆì´ì–´ í”Œë˜í”¼ë²„ë“œ**ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

### í•µì‹¬ ì»¨ì…‰

> [!IMPORTANT]
> **í˜‘ë™ ê²Œì„í”Œë ˆì´**: ê° í”Œë ˆì´ì–´ê°€ ìì‹ ì˜ ìƒˆë¥¼ ì¡°ì¢…í•˜ì§€ë§Œ, ëª¨ë“  ìƒˆê°€ ë°§ì¤„ë¡œ ì—°ê²°ë˜ì–´ ì„œë¡œ ì˜í–¥ì„ ë°›ìŠµë‹ˆë‹¤. **í•œ ë§ˆë¦¬ë¼ë„ ì¶©ëŒí•˜ë©´ ì „ì²´ ê²Œì„ ì˜¤ë²„**ì…ë‹ˆë‹¤.

**ìƒˆ ë°°ì¹˜**: P4 â† P3 â† P2 â† P1 (ê°€ë¡œ ì¼ì§ì„ , ë°§ì¤„ë¡œ ì—°ê²°)

---

## ğŸ® ê²Œì„ ë©”ì»¤ë‹ˆì¦˜

### 1. ìƒˆ(Bird) ì‹œìŠ¤í…œ

**ë°°ì¹˜**:

- 4ë§ˆë¦¬ê°€ ê°€ë¡œë¡œ ì¼ì§ì„  ë°°ì¹˜
- ê°„ê²©: ì•½ 80-100px
- ìˆœì„œ: ë§¨ ì•(P1) â†’ ë§¨ ë’¤(P4)

**ë¬¼ë¦¬ ì—°ê²°**:

```
P4 â†[ë°§ì¤„]â† P3 â†[ë°§ì¤„]â† P2 â†[ë°§ì¤„]â† P1
```

**ìƒí˜¸ì‘ìš©**:

- ê° í”Œë ˆì´ì–´ëŠ” ìì‹ ì˜ ìƒˆë§Œ ì í”„ ê°€ëŠ¥
- ë°§ì¤„ë¡œ ì—°ê²°ë˜ì–´ ìˆì–´ ë‹¤ë¥¸ ìƒˆì˜ ì›€ì§ì„ì— ì˜í–¥ë°›ìŒ
- ë°§ì¤„ ì¥ë ¥: ê±°ë¦¬ê°€ ë©€ì–´ì§€ë©´ ë‹¹ê¸°ëŠ” í˜ ë°œìƒ
- ë°§ì¤„ íƒ„ì„±: ìŠ¤í”„ë§ì²˜ëŸ¼ ë¶€ë“œëŸ½ê²Œ ì—°ê²°

### 2. ë°§ì¤„(Rope) ì‹œìŠ¤í…œ

**Phaser êµ¬í˜„ ë°©ë²•**:

- **Distance Constraint** ì‚¬ìš© (Phaser.Physics.Arcadeì—ëŠ” ì—†ìŒ)
- ëŒ€ì•ˆ: **ìˆ˜ë™ êµ¬í˜„** - ë§¤ í”„ë ˆì„ ê±°ë¦¬ ê³„ì‚° í›„ í˜ ì ìš©

**ë°§ì¤„ ë¡œì§**:

```typescript
// ë‘ ìƒˆ ì‚¬ì´ì˜ ê±°ë¦¬ ê³„ì‚°
const distance = Phaser.Math.Distance.Between(
  bird1.x,
  bird1.y,
  bird2.x,
  bird2.y,
);
const targetDistance = 80; // ê¸°ë³¸ ë°§ì¤„ ê¸¸ì´

// ê±°ë¦¬ê°€ ë©€ì–´ì§€ë©´ ë‹¹ê¸°ëŠ” í˜
if (distance > targetDistance) {
  const force = (distance - targetDistance) * 0.5; // ì¥ë ¥ ê³„ìˆ˜
  // bird1ì„ bird2 ë°©í–¥ìœ¼ë¡œ, bird2ë¥¼ bird1 ë°©í–¥ìœ¼ë¡œ ë‹¹ê¹€
}
```

**ì‹œê°ì  í‘œí˜„**:

- ìƒˆë“¤ ì‚¬ì´ì— ì„ (Line) ê·¸ë¦¬ê¸°
- ìƒ‰ìƒ: í”Œë ˆì´ì–´ ìƒ‰ìƒ ë˜ëŠ” í°ìƒ‰
- ë‘ê»˜: 2-3px

### 3. ì…ë ¥ ì‹œìŠ¤í…œ

**ê° í”Œë ˆì´ì–´ë³„ í‚¤ ë°”ì¸ë”©**:

```typescript
P1: Space ë˜ëŠ” í´ë¦­
P2: W í‚¤
P3: I í‚¤
P4: â†‘ (í™”ì‚´í‘œ ìœ„)
```

**ì í”„ ë©”ì»¤ë‹ˆì¦˜**:

- ìì‹ ì˜ ìƒˆì—ë§Œ ìœ„ë¡œ í˜ ì ìš©
- ë°§ì¤„ë¡œ ì—°ê²°ë˜ì–´ ìˆì–´ ë‹¤ë¥¸ ìƒˆë„ ê°„ì ‘ì ìœ¼ë¡œ ì˜í–¥ë°›ìŒ

### 4. ì¶©ëŒ ê°ì§€

**ê²Œì„ ì˜¤ë²„ ì¡°ê±´** (í•˜ë‚˜ë¼ë„ í•´ë‹¹í•˜ë©´ ì¦‰ì‹œ ì¢…ë£Œ):

- ìƒˆ ì¤‘ í•˜ë‚˜ë¼ë„ íŒŒì´í”„ ì¶©ëŒ
- ìƒˆ ì¤‘ í•˜ë‚˜ë¼ë„ ë°”ë‹¥ ì¶©ëŒ
- ìƒˆ ì¤‘ í•˜ë‚˜ë¼ë„ ì²œì¥ ì¶©ëŒ

### 5. ì ìˆ˜ ì‹œìŠ¤í…œ

**í˜‘ë™ ì ìˆ˜**:

- ëª¨ë“  ìƒˆê°€ íŒŒì´í”„ë¥¼ í†µê³¼í•´ì•¼ +1ì 
- ê°œì¸ ì ìˆ˜ ì—†ìŒ, íŒ€ ì ìˆ˜ë§Œ ì¡´ì¬
- ìƒì¡´ ì‹œê°„ ë³´ë„ˆìŠ¤ (ì„ íƒì‚¬í•­)

---

## ğŸ—ï¸ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
src/game/flappy/
â”œâ”€â”€ FlappyGameManager.ts      # ê²Œì„ ë©”ì¸ ë¡œì§
â”œâ”€â”€ BirdPrefab.ts              # ìƒˆ í”„ë¦¬íŒ¹
â”œâ”€â”€ RopeSystem.ts              # ë°§ì¤„ ë¬¼ë¦¬ ì‹œìŠ¤í…œ (NEW)
â”œâ”€â”€ PipePrefab.ts              # íŒŒì´í”„ í”„ë¦¬íŒ¹
â””â”€â”€ FlappyInputManager.ts      # ì…ë ¥ ê´€ë¦¬ (NEW)
```

---

## ğŸ“ êµ¬í˜„ ìƒì„¸

### 1. BirdPrefab ìˆ˜ì •

```typescript
export default class BirdPrefab extends Phaser.GameObjects.Container {
  private body: Phaser.Physics.Arcade.Body;
  private sprite: Phaser.GameObjects.Rectangle;
  private playerIndex: number;
  private playerColor: number;

  // ë°§ì¤„ ì—°ê²°ìš©
  public connectedBirds: BirdPrefab[] = [];

  constructor(
    scene: Phaser.Scene,
    x: number,
    y: number,
    playerIndex: number,
    color: number,
  ) {
    super(scene, x, y);

    this.playerIndex = playerIndex;
    this.playerColor = color;

    // ìƒˆ ìŠ¤í”„ë¼ì´íŠ¸ (í”Œë ˆì´ì–´ ìƒ‰ìƒ)
    this.sprite = scene.add.rectangle(0, 0, 40, 30, color);
    this.add(this.sprite);

    // ë¬¼ë¦¬ í™œì„±í™”
    scene.physics.add.existing(this);
    this.body = this.body as Phaser.Physics.Arcade.Body;
    this.body.setGravityY(600); // ì¤‘ë ¥
    this.body.setCollideWorldBounds(false); // ì²œì¥/ë°”ë‹¥ ì¶©ëŒì€ ìˆ˜ë™ ê°ì§€
  }

  jump(): void {
    this.body.setVelocityY(-300);
  }

  update(): void {
    // íšŒì „ ê°ë„ ì¡°ì ˆ
    const angle = Phaser.Math.Clamp(this.body.velocity.y * 0.1, -20, 60);
    this.setAngle(angle);
  }

  // ë°§ì¤„ ì—°ê²° ì¶”ê°€
  connectTo(bird: BirdPrefab): void {
    this.connectedBirds.push(bird);
  }
}
```

### 2. RopeSystem êµ¬í˜„ (NEW)

```typescript
export default class RopeSystem {
  private scene: Phaser.Scene;
  private birds: BirdPrefab[];
  private ropeLines: Phaser.GameObjects.Line[] = [];

  // ë°§ì¤„ ì„¤ì •
  private readonly ROPE_LENGTH = 80; // ê¸°ë³¸ ë°§ì¤„ ê¸¸ì´
  private readonly ROPE_STIFFNESS = 0.3; // ì¥ë ¥ ê³„ìˆ˜ (0~1)
  private readonly ROPE_DAMPING = 0.95; // ê°ì‡  ê³„ìˆ˜

  constructor(scene: Phaser.Scene, birds: BirdPrefab[]) {
    this.scene = scene;
    this.birds = birds;

    // ë°§ì¤„ ì‹œê°í™” ë¼ì¸ ìƒì„±
    for (let i = 0; i < birds.length - 1; i++) {
      const line = scene.add.line(0, 0, 0, 0, 0, 0, 0xffffff, 0.8);
      line.setLineWidth(3);
      this.ropeLines.push(line);
    }
  }

  update(): void {
    // ì¸ì ‘í•œ ìƒˆë“¤ ì‚¬ì´ì˜ ë°§ì¤„ ë¬¼ë¦¬ ì ìš©
    for (let i = 0; i < this.birds.length - 1; i++) {
      const bird1 = this.birds[i];
      const bird2 = this.birds[i + 1];

      this.applyRopeConstraint(bird1, bird2);
      this.updateRopeLine(i, bird1, bird2);
    }
  }

  private applyRopeConstraint(bird1: BirdPrefab, bird2: BirdPrefab): void {
    const dx = bird2.x - bird1.x;
    const dy = bird2.y - bird1.y;
    const distance = Math.sqrt(dx * dx + dy * dy);

    // ê±°ë¦¬ ì°¨ì´ ê³„ì‚°
    const diff = distance - this.ROPE_LENGTH;

    if (Math.abs(diff) > 1) {
      // 1px ì´ìƒ ì°¨ì´ë‚  ë•Œë§Œ ì ìš©
      // ì •ê·œí™”ëœ ë°©í–¥ ë²¡í„°
      const nx = dx / distance;
      const ny = dy / distance;

      // ì¥ë ¥ ê³„ì‚°
      const force = diff * this.ROPE_STIFFNESS;

      // ì–‘ìª½ ìƒˆì— ë°˜ëŒ€ ë°©í–¥ í˜ ì ìš©
      const body1 = bird1.body as Phaser.Physics.Arcade.Body;
      const body2 = bird2.body as Phaser.Physics.Arcade.Body;

      body1.velocity.x += nx * force;
      body1.velocity.y += ny * force;
      body2.velocity.x -= nx * force;
      body2.velocity.y -= ny * force;

      // ê°ì‡  ì ìš© (ì§„ë™ ë°©ì§€)
      body1.velocity.x *= this.ROPE_DAMPING;
      body1.velocity.y *= this.ROPE_DAMPING;
      body2.velocity.x *= this.ROPE_DAMPING;
      body2.velocity.y *= this.ROPE_DAMPING;
    }
  }

  private updateRopeLine(
    index: number,
    bird1: BirdPrefab,
    bird2: BirdPrefab,
  ): void {
    const line = this.ropeLines[index];
    line.setTo(bird1.x, bird1.y, bird2.x, bird2.y);
  }

  destroy(): void {
    this.ropeLines.forEach((line) => line.destroy());
  }
}
```

### 3. FlappyInputManager êµ¬í˜„ (NEW)

```typescript
export default class FlappyInputManager {
  private scene: Phaser.Scene;
  private birds: BirdPrefab[];
  private keys: { [key: string]: Phaser.Input.Keyboard.Key } = {};

  constructor(scene: Phaser.Scene, birds: BirdPrefab[]) {
    this.scene = scene;
    this.birds = birds;

    this.setupKeys();
  }

  private setupKeys(): void {
    const keyBindings = [
      { key: 'SPACE', playerIndex: 0 }, // P1
      { key: 'W', playerIndex: 1 }, // P2
      { key: 'I', playerIndex: 2 }, // P3
      { key: 'UP', playerIndex: 3 }, // P4
    ];

    keyBindings.forEach(({ key, playerIndex }) => {
      if (playerIndex < this.birds.length) {
        const keyObj = this.scene.input.keyboard?.addKey(key);
        if (keyObj) {
          keyObj.on('down', () => {
            this.birds[playerIndex].jump();
          });
        }
      }
    });

    // ë§ˆìš°ìŠ¤ í´ë¦­ (P1ë§Œ)
    this.scene.input.on('pointerdown', () => {
      if (this.birds.length > 0) {
        this.birds[0].jump();
      }
    });
  }
}
```

### 4. FlappyGameManager ìˆ˜ì •

```typescript
export default class FlappyGameManager {
  private scene: Phaser.Scene;
  private birds: BirdPrefab[] = [];
  private ropeSystem!: RopeSystem;
  private inputManager!: FlappyInputManager;
  private pipes: PipePrefab[] = [];
  private score: number = 0; // íŒ€ ì ìˆ˜
  private gameOver: boolean = false;

  init(playerCount: number, playerColors: number[]): void {
    // ìƒˆë“¤ì„ ê°€ë¡œë¡œ ë°°ì¹˜ (P1ì´ ë§¨ ì•)
    const startX = 150;
    const startY = 300;
    const spacing = 80;

    for (let i = 0; i < playerCount; i++) {
      const bird = new BirdPrefab(
        this.scene,
        startX + i * spacing,
        startY,
        i,
        playerColors[i],
      );
      this.birds.push(bird);
      this.scene.add.existing(bird);
    }

    // ë°§ì¤„ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
    this.ropeSystem = new RopeSystem(this.scene, this.birds);

    // ì…ë ¥ ê´€ë¦¬ì ì´ˆê¸°í™”
    this.inputManager = new FlappyInputManager(this.scene, this.birds);

    // íŒŒì´í”„ ìƒì„± ì‹œì‘
    this.startPipeSpawner();
  }

  update(): void {
    if (this.gameOver) return;

    // ìƒˆ ì—…ë°ì´íŠ¸
    this.birds.forEach((bird) => bird.update());

    // ë°§ì¤„ ë¬¼ë¦¬ ì ìš©
    this.ropeSystem.update();

    // ì¶©ëŒ ê°ì§€ (í•œ ë§ˆë¦¬ë¼ë„ ì¶©ëŒí•˜ë©´ ê²Œì„ ì˜¤ë²„)
    this.checkCollisions();

    // íŒŒì´í”„ ìŠ¤í¬ë¡¤
    this.updatePipes();
  }

  private checkCollisions(): void {
    for (const bird of this.birds) {
      // ì²œì¥/ë°”ë‹¥ ì¶©ëŒ
      if (bird.y < 0 || bird.y > this.scene.scale.height) {
        this.onGameOver();
        return;
      }

      // íŒŒì´í”„ ì¶©ëŒ
      for (const pipe of this.pipes) {
        if (this.checkBirdPipeCollision(bird, pipe)) {
          this.onGameOver();
          return;
        }
      }
    }
  }

  private onGameOver(): void {
    this.gameOver = true;
    console.log('ğŸ® ê²Œì„ ì˜¤ë²„! ìµœì¢… ì ìˆ˜:', this.score);
    this.scene.events.emit('gameEnd', { score: this.score });
  }
}
```

---

## ğŸ¨ UI/UX ê°œì„ 

### í”Œë ˆì´ì–´ í‘œì‹œ

**í™”ë©´ ìƒë‹¨ì— í”Œë ˆì´ì–´ ì •ë³´ í‘œì‹œ**:

```
P1 [Space] | P2 [W] | P3 [I] | P4 [â†‘]
```

**ê° í”Œë ˆì´ì–´ ìƒ‰ìƒ**:

- P1: íŒŒë€ìƒ‰ (#209cee)
- P2: ë¹¨ê°„ìƒ‰ (#e76e55)
- P3: ì´ˆë¡ìƒ‰ (#92cc41)
- P4: ë…¸ë€ìƒ‰ (#f2d024)

### ì ìˆ˜ í‘œì‹œ

**ì¤‘ì•™ ìƒë‹¨**:

```
í˜‘ë™ ì ìˆ˜: 15
```

---

## âœ… ê²€ì¦ ê³„íš

### 1. ë°§ì¤„ ë¬¼ë¦¬ í…ŒìŠ¤íŠ¸

1. ìƒˆ 1ë§ˆë¦¬ë§Œ ì í”„ â†’ ë‹¤ë¥¸ ìƒˆë“¤ë„ ì•½ê°„ ëŒë ¤ì˜¬ë¼ê°€ëŠ”ì§€ í™•ì¸
2. ìƒˆë“¤ ê°„ê²©ì´ ë©€ì–´ì§€ë©´ â†’ ë‹¹ê¸°ëŠ” í˜ì´ ì‘ìš©í•˜ëŠ”ì§€ í™•ì¸
3. ìƒˆë“¤ì´ ë„ˆë¬´ ê°€ê¹Œì›Œì§€ë©´ â†’ ë°€ì–´ë‚´ëŠ”ì§€ ë˜ëŠ” ìì—°ìŠ¤ëŸ½ê²Œ ìœ ì§€ë˜ëŠ”ì§€ í™•ì¸

### 2. í˜‘ë™ ê²Œì„í”Œë ˆì´ í…ŒìŠ¤íŠ¸

1. 2ëª… í”Œë ˆì´: P1ë§Œ ì í”„, P2ëŠ” ê°€ë§Œíˆ â†’ í˜‘ë ¥ í•„ìš”ì„± í™•ì¸
2. 4ëª… í”Œë ˆì´: ëª¨ë‘ ë‹¤ë¥¸ íƒ€ì´ë°ì— ì í”„ â†’ í˜¼ë€ìŠ¤ëŸ¬ìš´ì§€ í™•ì¸
3. í•œ ëª…ì´ íŒŒì´í”„ì— ì¶©ëŒ â†’ ì „ì²´ ê²Œì„ ì˜¤ë²„ í™•ì¸

### 3. ë‚œì´ë„ ë°¸ëŸ°ì‹±

- ë°§ì¤„ ì¥ë ¥ ì¡°ì ˆ (ROPE_STIFFNESS)
- ë°§ì¤„ ê¸¸ì´ ì¡°ì ˆ (ROPE_LENGTH)
- íŒŒì´í”„ ê°„ê²© ì¡°ì ˆ

---

## ğŸ“ êµ¬í˜„ ë‹¨ê³„

### Phase 1: ê¸°ë³¸ ìƒˆ + ë°§ì¤„ ì‹œìŠ¤í…œ (2ì‹œê°„)

- [ ] `BirdPrefab` êµ¬í˜„
- [ ] `RopeSystem` êµ¬í˜„
- [ ] ë°§ì¤„ ë¬¼ë¦¬ í…ŒìŠ¤íŠ¸

### Phase 2: ì…ë ¥ + íŒŒì´í”„ (1.5ì‹œê°„)

- [ ] `FlappyInputManager` êµ¬í˜„
- [ ] `PipePrefab` êµ¬í˜„
- [ ] íŒŒì´í”„ ìŠ¤í¬ë¡¤ ë° ìƒì„±

### Phase 3: ì¶©ëŒ + ì ìˆ˜ (1ì‹œê°„)

- [ ] ì¶©ëŒ ê°ì§€ (í•œ ë§ˆë¦¬ë¼ë„ ì¶©ëŒ ì‹œ ê²Œì„ ì˜¤ë²„)
- [ ] í˜‘ë™ ì ìˆ˜ ì‹œìŠ¤í…œ
- [ ] ê²Œì„ ì˜¤ë²„ ì²˜ë¦¬

### Phase 4: ë¡œë¹„ í†µí•© + í´ë¦¬ì‹± (1ì‹œê°„)

- [ ] ë¡œë¹„ì—ì„œ í”Œë ˆì´ì–´ ìˆ˜ ì„¤ì •
- [ ] UI ê°œì„  (í”Œë ˆì´ì–´ í‚¤ ì•ˆë‚´)
- [ ] ë°¸ëŸ°ì‹±

**ì´ ì˜ˆìƒ ì‹œê°„**: 5-6ì‹œê°„

---

## ğŸ¯ ì„±ê³µ ê¸°ì¤€

- âœ… ìƒˆë“¤ì´ ë°§ì¤„ë¡œ ì—°ê²°ë˜ì–´ ì„œë¡œ ì˜í–¥ì„ ë°›ìŒ
- âœ… ê° í”Œë ˆì´ì–´ê°€ ìì‹ ì˜ ìƒˆë§Œ ì¡°ì¢… ê°€ëŠ¥
- âœ… í•œ ë§ˆë¦¬ë¼ë„ ì¶©ëŒí•˜ë©´ ê²Œì„ ì˜¤ë²„
- âœ… í˜‘ë™ ì ìˆ˜ ì‹œìŠ¤í…œ ì‘ë™
- âœ… 1-4ëª… í”Œë ˆì´ì–´ ì§€ì›
- âœ… ë°§ì¤„ì´ ì‹œê°ì ìœ¼ë¡œ í‘œì‹œë¨

---

## ğŸ’¡ ë°¸ëŸ°ì‹± íŒ

**ë°§ì¤„ ì„¤ì • ê¶Œì¥ê°’**:

- `ROPE_LENGTH`: 80-100px (í”Œë ˆì´ì–´ ìˆ˜ì— ë”°ë¼ ì¡°ì ˆ)
- `ROPE_STIFFNESS`: 0.2-0.4 (ë„ˆë¬´ ë†’ìœ¼ë©´ ë”±ë”±í•¨)
- `ROPE_DAMPING`: 0.9-0.98 (ì§„ë™ ë°©ì§€)

**ë‚œì´ë„ë³„ ì¡°ì ˆ**:

- Easy: ë°§ì¤„ ê¸¸ì´ â†‘, ì¥ë ¥ â†“, íŒŒì´í”„ ê°„ê²© â†‘
- Normal: ê¸°ë³¸ê°’
- Hard: ë°§ì¤„ ê¸¸ì´ â†“, ì¥ë ¥ â†‘, íŒŒì´í”„ ê°„ê²© â†“
